<%= render partial: "decidim/elections/admin/elections/tabs_menu" %>

<% add_decidim_page_title(t(".title")) %>

<div class="item_show__header">
  <h1 class="item_show__header-title">
    <%= t(".title") %>
    <% if allowed_to?(:update, :census, election: election) && !election.published? %>
      <%= link_to t(".new_entry"), new_election_census_update_path(election), class: "button button__sm button__secondary" %>
      <%= link_to t(".import_from_survey"), election_survey_imports_path(election), class: "button button__sm button__transparent-secondary" %>
    <% end %>
  </h1>
</div>

<div class="mb-4">
  <%= cell("decidim/announcement", t(".entries_count", count: election.voters.count), callout_class: "warning") %>
</div>

<div class="filters__section mb-4">
  <div class="fcell search">
    <%= form_tag election_census_updates_path(election), method: :get do %>
      <div class="flex gap-2 items-center">
        <div class="input-group flex-1">
          <%= search_field_tag :q, params[:q], placeholder: t(".search_placeholder"), class: "input-group-field w-full", autocomplete: "off" %>
        </div>
        <button type="submit" class="button button__sm button__primary">
          <%= t(".search") %>
        </button>
      </div>
    <% end %>
  </div>
</div>

<% if @voters.any? %>
  <div class="table-stacked">
    <table class="table-list">
      <thead>
        <tr>
          <th><%= t(".user_identifier") %></th>
          <th><%= t(".created_at") %></th>
          <th><%= t(".actions") %></th>
        </tr>
      </thead>
      <tbody>
        <% @voters.each do |voter| %>
          <tr>
            <td data-label="<%= t(".user_identifier") %>">
              <%= voter.data&.dig(identifier_column) %>
            </td>
            <td data-label="<%= t(".created_at") %>">
              <%= l(voter.created_at, format: :decidim_short) %>
            </td>
            <td class="table-list__actions" data-label="<%= t(".actions") %>">
              <% if allowed_to?(:update, :census, election: election) %>
                <%= link_to election_census_update_path(election, voter),
                            method: :delete,
                            data: { confirm: t(".confirm_delete") },
                            class: "action-icon action-icon--remove" do %>
                  <%= icon "delete-bin-line" %>
                  <span class="sr-only"><%= t(".delete") %></span>
                <% end %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= decidim_paginate @voters %>
<% end %>
